\section{Най-малки неподвижни точки}\label{sect:lfp}\index{най-малка неподвижна точка}

\begin{itemize}
\item\index{неподвижна точка}
  Да фиксираме произволна област на Скот $\A = (A, \sqsubseteq, \bot)$ и да разгледаме едно изображение $f:\A\to\A$.
  Казваме, че $a \in \A$ е {\bf неподвижна точка} на $f$, ако $f(a) = a$.
\item\index{най-малка неподвижна точка}
  Казваме, че $a \in \A$ е {\bf най-малката неподвижна точка} на $f$, ако:
  \begin{itemize}
  \item 
    $a$ е неподвижна точка, т.е. $f(a) = a$;
  \item
    за всяко $b \in \A$ със свойството, че $f(b) = b$ имаме $a \sqsubseteq b$.
  \item
    \marginpar{least fixed point}
    Ще означаваме най-малката неподвижна точка на $f$ като $\lfp(f)$.
  \end{itemize}
\end{itemize}

\begin{framed}
\begin{theorem}[Клини]
  \label{th:knaster-tarski}
  \index{Клини}
  Нека $\A$ е област на Скот.
  Всяко $f \in \Cont{\A}{\A}$ притежава най-малка неподвижна точка.
\end{theorem}
\end{framed}
\begin{proof}
  \marginpar{В \cite{ditchev-soskov} се нарича теорема на Кнастер-Тарски. Според \href{https://en.wikipedia.org/wiki/Kleene_fixed-point_theorem}{уикипедия} е теорема на Клини. Теоремата на Кнастер-Тарски е по-силна и говори за монотонни изображения в решетки.}
  Определяме монотонно растяща редица от елементи на $\A$ по следния начин:
  \begin{align*}
    & a_0 \df \bot & \comment = f^0(\bot)\\
    & a_{n+1} \df f(a_n) & \comment = f^{n+1}(\bot).
  \end{align*}

  Първо ще докажем с индукция по $n$, че $\chain{a}{n}$ е верига.
  Ясно е, че $a_0 \sqsubseteq a_1$.
  Да приемем, че $a_n \sqsubseteq a_{n+1}$. Тогава, понеже всяко непрекъснато
  изображение е монотонно, то имаме, че
  \[\underbrace{f(a_n)}_{a_{n+1}} \sqsubseteq \underbrace{f(a_{n+1})}_{a_{n+2}}.\]

  Нека $a \df \bigsqcup_i a_i$. Тогава 
  \begin{align*}
    f(a) & = f(\bigsqcup_i a_i) & \comment a \df \bigsqcup_i a_i\\
         & = \bigsqcup_i f(a_i) & \comment f \text{ е непрекъсната}\\
         & = \bigsqcup_i a_{i+1} & \comment a_{i+1} = f(a_i)\\
         & = \bigsqcup_i a_i & \comment \text{защото }\chain{a}{i}\text{ е верига}\\
         & = a.
  \end{align*}
  Така доказахме, че $a$ е \emph{ неподвижна точка} на $f$.
  Остана да видим, че е най-малката неподвижна точка на $f$.

  Нека $b = f(b)$. С индукция по $n$ ще докажем, свойството $(\forall n)[a_n \sqsubseteq b]$.
  \begin{itemize}
  \item 
    За $n = 0$ е очевидно.
  \item
    Да приемем, че $a_n \sqsubseteq b$.
    Тогава $a_{n+1} \df f(a_n) \sqsubseteq f(b) = b$, защото $f$ е монотонно изображение.    
  \end{itemize}
  Така доказахме, че $b$ е горна граница на веригата $\chain{a}{n}$.
  Заключаваме, че $a \df \bigsqcup_n a_n \sqsubseteq b$.
  Следователно, $a$ е \emph{ най-малката неподвижна точка} на $f$,
  т.е. $a = \lfp(f)$.
\end{proof}

\begin{problem}
  Покажете, че съществува област на Скот $\A$ и изображение $f \in \Mon{\A}{\A}$, което притежава най-малка неподвижна точка, но тя не е $\bigsqcup_n f^n(\bot^\A)$.
\end{problem}
\ifhints\begin{hint}
  Вземете областта на Скот $\A$ и монотонното изображение $f$ както в \Prop{continuous-mappings-not-monotone}.
  % Да разгледаме $\A = (A,\ \sqsubseteq,\ a_0)$, където елементите на $A$ са подредени по следния начин:
  % \[A = \{ a_0 \sqsubset a_1 \sqsubset \cdots \sqsubset a_n \sqsubset \cdots \sqsubset a_\omega \sqsubset b \}.\]
  % т.е. $A$ е съставена от веригата ${(a_n)}^\infty_{n=0}$ веднага следвана от елементите $a_\omega$ и $b$.
  % Да обърнем внимание, че $\bigsqcup_n a_n = a_\omega$.
  % Сега да разгледаме изображението $f:\A\to\A$, където за всяко $n$,
  % \begin{align*}
  %   & f(a_n) = a_{n+1}\\
  %   & f(a_\omega) = b\\
  %   & f(b) = b.
  % \end{align*}
  % Лесно се вижда, че това изображение е монотонно.
  Лесно се вижда, че $f$ не е непрекъснато изображение, защото $\bigsqcup_n a_n = a_\omega$, и тогава:
  \[f(\bigsqcup_n a_n) = f(a_\omega) = b \neq a_\omega = \bigsqcup_n a_{n+1} = \bigsqcup_n \{f(a_n)\}.\]
  Според дефиницията на изображението $f$, единствената неподвижна точка на $f$ е елементът $b$.
  Това означава, че $b$ е също и най-малката неподвижна точка.
  \marginpar{Имаме, че $f^n(a_0) = a_n$.}
  Това е пример за монотонно изображение, което не е непрекъснато, но притежава най-малка неподвижна точка $b$,
  макар и тя да не е $a_\omega = \bigsqcup_n f^n(a_0)$.
\end{hint}
\fi

% \begin{problem}
%   Да разгледаме $\Gamma:\Partial{\Nat}{\Nat} \to \Partial{\Nat}{\Nat}$, където
%   \begin{enumerate}[a)]
%   \item
%     $\Gamma(f)(x) = 5$, за всяко $x \in \Nat$;
%   \item
%     $\Gamma(f)(x)$ не е деф. за всяко $x \in \Nat$;
%   \item
%     $\Gamma(f) = f$;
%   \item
%     $\Gamma(f) = f\circ f$;
%   \item
%     $\Gamma(f)(x) = x * f(x+1)$;
%     \item
%     $\Gamma(f)(x) =
%     \begin{cases}
%       \text{не е деф.}, & \text{ ако }x = 0\\
%       x * f(x-1), & \text{ ако }x > 0.
%     \end{cases}$    
%   \item
%     $\Gamma(f)(x) =
%     \begin{cases}
%       0, & \text{ ако }x = 0\\
%       x * f(x-1), & \text{ ако }x > 0.
%     \end{cases}$
%     \item
%     $\Gamma(f)(x) =
%     \begin{cases}
%       1, & \text{ ако }x = 0\\
%       x * f(x-1), & \text{ ако }x > 0.
%     \end{cases}$    
%   \end{enumerate}
% \end{problem}


% \newpage

% \begin{example}
%   Да разгледаме следното изображение $\Gamma:\Partial{\Nat}{\Nat} \to \Partial{\Nat}{\Nat}$, където
%   \[\Gamma(f)(x) \simeq
%     \begin{cases}
%       0, & \text{ ако }x = 0\\
%       x + f(x-1), & \text{ ако }x > 0.
%     \end{cases}\]
%   Първо да видим, че $\Gamma$ е монотонно изображение.
%   Нека $f \subseteq g$.
%   Трябва да докажем, че за всяко $x$, ако $\Gamma(f)(x) \simeq y$, то $\Gamma(g)(x) \simeq y$.
%   \begin{itemize}
%   \item
%     Нека $x = 0$.
%     Тогава $\Gamma(f)(0) \simeq 0 \simeq \Gamma(g)(0)$.
%   \item
%     Нека $x > 0$ и да приемем, че $\Gamma(f)(x) \simeq x + f(x-1) \simeq y$.
%     Това означава, че $f(x-1) \simeq z$, за някое $z$, и $x + z = y$.
%     От $f \subseteq g$ следва, че имаме също и $g(x-1) \simeq z$.
%     Тогава е ясно, че $\Gamma(g)(x) \simeq x + g(x-1) \simeq x+z = y$.
%   \end{itemize}
%   Разгледахме всички възмножни случаи за естественото число $x$ и
%   \marginpar{$\texttt{Graph}(\Gamma(f)) \subseteq \texttt{Graph}(\Gamma(g))$.}
%   видяхме, че за произволно $x$, ако $\Gamma(f)(x) \simeq y$, то $\Gamma(g)(x) \simeq y$.
%   Заключаваме, че $\Gamma(f) \subseteq \Gamma(g)$, т.е. $\Gamma$ е монотонно изображение.

%   Нека сега да видим, че $\Gamma$ е непрекъснато изображение.
%   Да разгледаме произволна верига $\chain{f}{i}$ от частични функции.
%   Трябва да докажем, че
%   \[\Gamma(\bigsqcup_i f_i) = \bigsqcup_i \Gamma(f_i).\]
%   Щом $\Gamma$ е монотонно, от \Prop{monotone-chain} вече знаем, че
%   \[\bigsqcup_i \Gamma(f_i) \subseteq \Gamma(\bigsqcup_i f_i).\]
%   Остава да докажем обратната посока. И така, нека първо да вземем $x = 0$.
%   Тогава $\Gamma(\bigsqcup_i f_i)(0) \simeq 0$. От дефиницията от $\Gamma$ знаем, че
%   за всяко $i$, $\Gamma(f_i)(0) \simeq 0$ и оттук $(\bigsqcup_i \Gamma(f_i))(0) \simeq 0$.
%   Следователно,
%   \[\Gamma(\bigsqcup_i f_i)(0) \simeq 0 \simeq (\bigsqcup_i \Gamma(f_i))(0).\]
%   Нека сега $x > 0$. Тогава
%   \marginpar{Да напомним, че $(\bigsqcup_i f_i)(u) \simeq v$ точно тогава, когато съществува индекс $i$, за който $f_i(u) = v$.}
%   \[\Gamma(\bigsqcup_i f_i)(x) \simeq x + (\bigsqcup_i f_i)(x-1) \simeq y.\]
%   Ясно е, че съществува $z$, за което $(\bigsqcup_i f_i)(x-1) \simeq z$ и $x + z = y$.
%   Знаем, че съществува индекс $i$, за който $f_i(x-1) \simeq z$.
%   Тогава, понеже $\Gamma(f_i)(x) \simeq x + f_i(x-1) \simeq x+z = y$, то следва, че $(\bigsqcup_i \Gamma(f_i))(x) \simeq y$.

%   Сега вече можем да намерим $\lfp(\Gamma) = \bigsqcup_n \Gamma^n(\bm{\bot})$.
%   Ще докажем, че
%   \[\lfp(\Gamma)(x) \simeq \frac{x(x+1)}{2}\] за всяко естествено число $x$.
%   Нека за улеснение да означим $g_n = \Gamma^n(\bm{\bot})$.
%   Ще докажем, че за всяко $n$,
%   \[g_n(x) \simeq \begin{cases}
%       \sum^x_{i=1}i, & \text{ ако } x < n\\
%       \text{не е деф.}, & \text{ ако } x \geq n.
%     \end{cases}\]
%   Ясно е, че $g_0 = \bm{\bot}$, което може да се запише и така:
%   \marginpar{Да напомним, че $\Gamma^0(g) = g$ и $\Gamma^{n+1}(g) = \Gamma(\Gamma^n(g))$.}
%   \[g_0(x) \simeq \begin{cases}
%       \sum^x_{i=1}i, & \text{ ако } x < 0\\
%       \text{не е деф.}, & \text{ ако } x \geq 0.
%     \end{cases}\]
%   Да приемем, че нашето твърдение е изпълнено за $g_n$.
%   Ще докажем, че то е изпълнено и за $g_{n+1}$. И така,
%   \begin{align*}
%     g_{n+1}(x) & \simeq= \Gamma(g_n)(x)\\
%                &  \simeq \begin{cases}
%                  0, & \text{ ако } x = 0\\
%                  x + g_n(x-1), & \text{ ако }x > 0\\
%                \end{cases}\\
%                & \stackrel{\text{И.П.}}{\simeq} \begin{cases}
%                  0, & \text{ ако } x = 0\\
%                  x + \sum^{x-1}_{i=1}i , & \text{ ако } 0 \leq x-1 < n\\
%                  \text{не е деф.}, & \text{ ако }x-1 \geq n\\
%                \end{cases}\\
%                & \simeq \begin{cases}
%                  0, & \text{ ако } x = 0\\
%                  \sum^{x}_{i=1}i , & \text{ ако } 1 \leq x < n+1\\
%                  \text{не е деф.}, & \text{ ако }x \geq n+1\\
%                \end{cases}\\
%                & \simeq \begin{cases}
%                  \sum^{x}_{i=1}i , & \text{ ако } x < n+1\\
%                  \text{не е деф.}, & \text{ ако }x \geq n+1.
%                \end{cases}
%   \end{align*}
%   Сега можем да заключим, че за всяко естествено число $x$,
%   \[g_{x+1}(x) \simeq \sum^x_{i=1}i = \frac{x(x+1)}{2}.\]
%   Тогава
%   \[\texttt{lfp}(\Gamma)(x) \simeq (\bigsqcup_i g_i)(x) \simeq \frac{x(x+1)}{2}.\]
% \end{example}

% Казваме, че елементът $a$ е {\bf преднеподвижна точка} на $f$,
% ако $f(a) \sqsubseteq a$.

\marginpar{Да се обясни къде се използва това твърдение.}
\begin{proposition}\label{pr:prefix-point}
  За всяко $f \in \Cont{\A}{\A}$ е изпълнено, че 
  \[(\forall a \in \Pref(f))[\lfp(f) \sqsubseteq a],\]
  където
  \index{преднеподвижна точка}
  \[\Pref(f) \df \{a \in \A \mid f(a) \sqsubseteq a\}\]
  е множеството от всички преднеподвижни точки на $f$.
  Това означава, че $\lfp(f)$ е най-малката преднеподвижна точка на $f$.
\end{proposition}
\begin{proof}
  Знаем от \hyperref[th:knaster-tarski]{Теоремата на Клини}, че $\lfp(f) = \bigsqcup_n f^n(\bot)$.
  Също така знаем, че $\chain{b}{n}$ е верига, където за улеснение сме положили $b_n \df f^n(\bot)$. 
  Ясно е също, че $\texttt{Pref}(f) \neq \emptyset$, защото $\lfp(f) \in \texttt{Pref}(f)$.
  Да фиксираме прозиволен елемент $a\in \texttt{Pref}(f)$.
  С индукция по $n$ ще докажем, че $b_n \sqsubseteq a$ за всяко $n$.
  \begin{itemize}
  \item 
    За $n = 0$ е очевидно, защото тогава $b_0 \df \bot \sqsubseteq a$.
  \item
    Да приемем, че $b_n \sqsubseteq a$.
    Ще докажем, че $b_{n+1} \sqsubseteq a$.
    Но това е лесно.
    \begin{align*}
      b_{n+1} & = f(b_n) & \comment \text{от деф. на }b_{n+1}\\
      & \sqsubseteq f(a) & \comment b_n \sqsubseteq a\ \&\ f\text{ е мон.}\\
      & \sqsubseteq a & \comment a \in \texttt{Pref}(f).
    \end{align*}
  \end{itemize}
  Така доказахме, че за всяко $n$, $b_n \sqsubseteq a$,
  откъдето следва, че $a$ е горна граница за веригата $\chain{b}{n}$, откъдето директно получаваме, че
  \[\lfp(f) = \bigsqcup_n b_n \sqsubseteq a.\]
\end{proof}

\begin{problem}
  Нека $\A$ е област на Скот и нека $f \in \Cont{\A}{\A}$.
  Да разгледаме множеството $B = \{a \in \A \mid f(a) = f\}$.
  Вярно ли е, че $\B = (B, \sqsubseteq, \lfp(f))$ е област на Скот.
  Обосновете се!
\end{problem}

\begin{problem}% Gunter textbook
  Нека $f \in \Cont{\A}{\A}$.
  Да разгледаме множеството 
  \[B = \{a \in \A \mid f(a) \sqsubseteq a\}.\]
  Вярно ли е, че 
  \[\B = (B, \sqsubseteq^\A, \lfp(f))\] е област на Скот?
  Обосновете се!
\end{problem}


\begin{problem} % Gunter textbook
  Да разгледаме множеството
  \[B = \{f \in \Mon{\A}{\A} \mid f\circ f = f\}.\]
  Вярно ли е, че 
  \[\B = (B,\ \sqsubseteq,\ \lambda x.\bot^\A)\] е област на Скот,
  където 
  \[f \sqsubseteq g \df (\forall a\in\A)[f(a) \sqsubseteq^\A g(a)] ?\]
  Обосновете се!
\end{problem}


\begin{problem}
  \label{prob:domains:lfp:compositon}
  \marginpar{Задача в Кеймбридж 2020 г. \cite{cambridge-website}}
  Нека $\A$ и $\B$ са области на Скот и нека $f \in \Cont{\A}{\B}$ и $g \in \Cont{\B}{\A}$.
  Докажете, че е изпълнено равенството:
  \[\lfp(f \circ g) = f(\lfp(g \circ f)).\]
\end{problem}

\begin{problem}
  \label{prob:domains:lfp:compositon-1}
  \marginpar{Изображения $h$, за които $h(\bot^\A) = \bot^\B$ се наричат точни. На англ. strict.}
  Нека $\A$ и $\B$ са области на Скот и нека $f \in \Cont{\A}{\A}$, $g \in \Cont{\B}{\B}$,
  и $h \in \Cont{\A}{\B}$, за които е изпълнено свойството, че $h \circ f = g \circ h \in \Cont{\A}{\B}$.
  Докажете, че ако $h$ е такава, че $h(\bot^{\A}) = \bot^\B$, то е изпълнено, че:
  \[\lfp(g) = h(\lfp(f)).\]
\end{problem}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../sep"
%%% End:
