\chapter{Езикът \REG}\index{език!регулярен}

\section{Регулярни изрази}

Да фиксираме азбуката $\Sigma = \{a_1,\dots,a_k\}$.
\marginpar{Обърнете внимание, че нямаме звездата на Клини в дефиницията на термовете.}
Следната абстрактна граматика 
\[\tau ::= \varepsilon\ |\ a \cdot X\ |\ \tau_1 + \tau_2.\]
описва термовете на езика \REG, където $a$ означава буква от азбуката $\Sigma$, а $X$ означава променлива. Нека имаме и безкраен набор от променливи $X_0,X_1,\dots$.
\marginpar{Ще използваме малките гръцки букви $\tau,\rho,\mu$, евентуално с индекси, за да означаваме термовете. Думите над азбуката $\Sigma$ ще означаваме с малките гръцки букви $\alpha$, $\beta$, $\gamma$.}
Програмите на езика езика $\texttt{REG}$ имат следния вид:
\begin{align*}
  & X_1 = \tau_1[X_1,\dots,X_n]\\
  & \ \vdots\\
  & X_n = \tau_n[X_1,\dots,X_n].
\end{align*}
Ето един пример за програма:
\begin{align*}
  & X_1 = a \cdot X_1 + b \cdot X_2\\
  & X_2 = \varepsilon + b \cdot X_1.
\end{align*}


\section{Операционна семантика}

Да фиксираме една програма на езика \REG:
\begin{align*}
  & X_1 = \tau_1[X_1,\dots,X_n]\\
  & \ \vdots\\
  & X_n = \tau_n[X_1,\dots,X_n].
\end{align*}

С индукция по $\ell$, дефинираме релацията $\tau \Downarrow^\ell \alpha$,
където $\tau$ е терм на езика \REG със свободни променливи измежду $X_1,\dots, X_n$.

\marginpar{
  \begin{itemize}
  \item 
    Тук е важно да се отбележи, че дефиницията на операционната семантика не можем да я дадем с индукция по построението на термовете. Защо?
  \item
    Тук няма как да дефинираме релация $\tau \Downarrow L$, където $L$ е език, защото все пак искаме всяко изчисление да трае краен брой стъпки, а това няма как да стане, когато $L$ е безкраен език.
  \end{itemize}
}


\begin{framed}
  \begin{figure}[H]
    \begin{subfigure}[b]{0.5\textwidth}
      \begin{prooftree}
        \AxiomC{}
        \LeftLabel{\scriptsize{(eps)}}
        \UnaryInfC{$\varepsilon \Downarrow^0 \varepsilon$}
      \end{prooftree}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.5\textwidth}
      \begin{prooftree}
        \AxiomC{$\tau_i \Downarrow^\ell \beta$}
        \AxiomC{$\alpha = a\cdot \beta$}
        \RightLabel{\scriptsize{(rec)}}
        \BinaryInfC{$a \cdot X_i \Downarrow^{\ell+1} \alpha$}
      \end{prooftree}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \begin{prooftree}
        \AxiomC{$\tau_1 \Downarrow^\ell \alpha$}
        \LeftLabel{\scriptsize{(left-or)}}
        \UnaryInfC{$\tau_1 + \tau_2 \Downarrow^{\ell+1} \alpha$}
      \end{prooftree}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.5\textwidth}
      \begin{prooftree}
        \AxiomC{$\tau_2 \Downarrow^\ell \alpha$}
        \RightLabel{\scriptsize{(right-or)}}
        \UnaryInfC{$\tau_1 + \tau_2 \Downarrow^{\ell+1} \alpha$}
      \end{prooftree}
    \end{subfigure}
    \caption{Правила на операционната семантика на езика \REG.}
  \end{figure}
\end{framed}
Ще пишем $\tau \Downarrow \alpha$ точно тогава, когато съществува $\ell$, за което $\tau \Downarrow^\ell \alpha$.


\begin{proposition}
  Докажете, че ако $\tau \Downarrow \alpha$ и $\tau \Downarrow \beta$, то $\alpha = \beta$.
\end{proposition}


\begin{example}
  \marginpar{На всяка променлива от програмата $R$ съответства състояние на автомата.}
  Нека $\Sigma = \{a,b\}$. Да разгледаме програмата $R$, където:
  \begin{align*}
    & X_1 = \overbrace{a \cdot X_1 + b \cdot X_2 + \varepsilon}^{\tau_1[X_1,X_2]}\\
    & X_2 = \underbrace{b \cdot X_2 + \varepsilon}_{\tau_2[X_1,X_2]}.
  \end{align*}
  Съобразете, че за всеки две естествени числа $n$ и $k$ е изпълнено, че $\tau_1~\Downarrow~a^k b^n$ и $\tau_2~\Downarrow~b^n$.
  \begin{figure}[H]
      \centering
      \begin{tikzpicture}[->,>=stealth,thick,node distance=65pt]
        \tikzstyle{every state}=[circle,minimum size=20pt,auto]
        
        \node[initial, state, accepting]   (0) {$X_1$};
        \node[state, accepting]            (1) [right of=0]{$X_2$};
        
        \path
        (0) edge [loop above]   node [above] {$a$}    (0)
        (0) edge [bend left=15] node [above] {$b$}    (1)
        (1) edge [loop above]   node [above] {$b$}    (1);
        % (1) edge [bend left=15] node [above] {$a$}    (2)
        % (2) edge [bend left=45] node [below] {$a$}    (0)
        % (2) edge [bend left=15] node [above] {$b$}    (3)
        % (3) edge [loop above]   node [above] {$a,b$}  (3);
      \end{tikzpicture}
      \caption{Краен автомат съотвестващ на програмата $R$.}
    \end{figure}
\end{example}

\section{Денотационна семантика}

\begin{problem}
  Докажете, че $\mathcal{S} = (\mathcal{P}(\Sigma^\star), \subseteq, \emptyset)$ е област на Скот.
\end{problem}

За всеки терм $\tau[X_1,\dots,X_n]$ дефинираме изображението
% \marginpar{Тук за променливите използваме главни букви за да се сещаме, че те приемат стойности множества от думи.}
\[\val{\tau}: \mathcal{P}(\Sigma^\star)^n \to \mathcal{P}(\Sigma^\star)\]
 по следния начин:
\begin{itemize}
\item 
  $\val{\varepsilon}(L_1,\dots,L_n) = \{\varepsilon\}$.
\item 
  $\val{a_i \cdot X_j}(L_1,\dots,L_n) = \{a_i\} \cdot L_j$.
\item
  $\val{\tau_1 + \tau_2}(L_1,\dots,L_n) = \val{\tau_1}(L_1,\dots,L_n) \cup \val{\tau_2}(L_1,\dots,L_n)$.
\end{itemize}

\begin{problem}
  Докажете, че за всеки терм $\tau$ на езика \REG имаме, че $\val{\tau}$ е непрекъснато изображение в областта на Скот
  $\mathcal{S} = ( \mathcal{P}(\Sigma^\star),\subseteq, \emptyset)$.
\end{problem}

\marginpar{Програмата е просто текст. Системата е редица от уравнения на непрекъснати изображения.}

\begin{example}
  Да разгледаме програмата $R$, където:
  \begin{align*}
    & X_1 = \overbrace{b \cdot X_1 + a\cdot X_2}^{\tau_1[X_1,X_2]}\\
    & X_2 = \underbrace{\varepsilon}_{\tau_2[X_1,X_2]}.
  \end{align*}
  Според горната дефиниция на семантика на термове, на програмата $R$ съотвества следната система от непрекъснати изображения:
  \begin{align*}
    & L = \overbrace{\{b\} \cdot L \cup \{a\} \cdot M}^{\val{\tau_1}(L,M)}\\
    & M = \underbrace{\{\varepsilon\}}_{\val{\tau_2}(L,M)}.
  \end{align*}
  От \Th{sep:min-solution-system} знаем, че тази система има най-малко решение. Нека да го намерим.
  За тази цел, да дефинираме непрекъснатото изображение $\Gamma:\mathcal{P}(\Sigma^\star)^2 \to \mathcal{P}(\Sigma^\star)^2$ като
  \marginpar{От \Prop{cartesian-continuous} знаем, че $\Gamma$ е непрекъснато изображение.}
  \[\Gamma \df \val{\tau_1} \times \val{\tau_2},\]
  т.е. за произволни езици $L$ и $M$ над азбуката $\Sigma$ е изпълнено, че:
  \[\Gamma(L,M) = (\val{\tau_1}(L,M), \val{\tau_2}(L,M)).\]

  От \hyperref[th:knaster-tarski]{Теоремата на Клини} знаем как можем да намерим най-малката неподвижна точка на $\Gamma$,
  която ще бъде и най-малкото решение на горната система.

  \begin{itemize}
  \item 
    $(L_0,M_0) \df (\emptyset,\emptyset)$;
  \item
    $(L_1,M_1) \df \Gamma(L_0,M_0) = (\val{\tau_1}(L_0,M_0), \val{\tau_2}(L_0,M_0)) = (\emptyset, \{\varepsilon\})$;
  \item
    $(L_2,M_2) \df \Gamma(L_1,M_1) = (\val{\tau_1}(L_1,M_1), \val{\tau_2}(L_1,M_1)) = (\{a\},\{\varepsilon\})$;
  \item
    $(L_3,M_3) \df \Gamma(L_2,M_2) = (\val{\tau_1}(L_2,M_2), \val{\tau_2}(L_2,M_2)) = (\{ba,a\},\{\varepsilon\})$;
  \item
    $(L_4,M_4) \df \Gamma(L_3,M_3) =(\val{\tau_1}(L_3,M_3), \val{\tau_2}(L_3,M_3)) = (\{bba, ba,a\},\{\varepsilon\})$;
  \item
    $(L_5,M_5) \df \Gamma(L_4,M_4) = ( \val{\tau_1}(L_4,M_4), \val{\tau_2}(L_4,M_4)) = (\{bba, bba, ba,a\},\{\varepsilon\})$.
  \end{itemize}
  Лесно се съобразява, че $L_n = \{ b^ka \mid k < n\}$, а $M_n = \{\varepsilon\}$. Тогава
  \[\lfp( \Gamma ) = (\bigcup_n L_n, \bigcup_n M_n) = (\{b\}^\star \cdot \{a\}, \{\varepsilon\} ).\]
\end{example}

\begin{example}
  Да разгледаме следния краен детерминиран автомат:
  \marginpar{Означаваме с $\abs{\omega}_a$ броя на срещанията на $a$ в думата $\omega$.}
  \begin{figure}[H]
    \centering
    \begin{tikzpicture}[->,>=stealth,thick,node distance=65pt]
      \tikzstyle{every state}=[circle,minimum size=20pt,auto]
      
      \node[initial, state, accepting]         (0) {$q_1$};
      \node[state]                             (1) [right of=0]{$q_2$};
      \node[state]                             (2) [right of=1]{$q_3$};
      
      \path 
      (0) edge [loop above]   node   [above] {$b$}    (0)
      (0) edge [bend left=15] node   [above] {$a$}    (1)
      (1) edge [loop above]   node   [above] {$b$}    (1)
      (1) edge [bend left=15] node   [above] {$a$}    (2)
      (2) edge [loop above]   node   [above] {$b$}    (2)
      (2) edge [bend left=45] node   [below] {$a$}    (0);
    \end{tikzpicture}
    \caption{Автомат разпознаващ $\{\omega \in \{a,b\}^\star \mid \abs{\omega}_{a} \equiv 0 \bmod\ 3\}$}
  \end{figure}
  На този автомат съответства следната програма $R$:
  \begin{align*}
    & X_1 = a \cdot X_2 + b \cdot X_1 + \varepsilon \\
    & X_2 = a \cdot X_3 + b \cdot X_2\\
    & X_3 = a \cdot X_1 + b \cdot X_3.
  \end{align*}
  На тази програма съответства системата:
  \begin{align*}
    & L_1 = \{a\} \cdot L_2 \cup \{b\} \cdot L_1 \cup \{\varepsilon\}\\
    & L_2 = \{a\} \cdot L_3 \cup \{b\} \cdot L_2\\
    & L_3 = \{a\} \cdot L_1 \cup \{b\} \cdot L_3.
  \end{align*}
  Най-малкото решение на тази система е тройката $(\hat{L}_1,\hat{L}_2,\hat{L}_3)$ от следните езици:
  \begin{align*}
    \hat{L}_1 = & \{\omega \in \{a,b\}^\star \mid \abs{\omega}_{a} \equiv 0 \bmod\ 3\}\\
    \hat{L}_2 = & \{\omega \in \{a,b\}^\star \mid \abs{\omega}_{a} \equiv 2 \bmod\ 3\}\\
    \hat{L}_3 = & \{\omega \in \{a,b\}^\star \mid \abs{\omega}_{a} \equiv 1 \bmod\ 3\}.
  \end{align*}
\end{example}

\begin{example}
  Да разгледаме системата от само едно уравнение
  \[L = \{a\} \cdot L.\]
  Най-малкото решение на тази система е езикът $\emptyset$,
  но тази система има за решение и езикът $\{a^n \mid n > 0\}$.
  Да разгледаме сега програмата
  \[X = \underbrace{a \cdot X}_{\tau[X]}.\]
  Лесно се съобразява, че $\emptyset = \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}$.
\end{example}

  
\begin{problem}
  Докажете, че най-малкото решение на системата 
  \begin{align*}
    & X_1 = a \cdot X_1 + b \cdot X_2 + \varepsilon\\
    & X_2 = b \cdot X_2 + \varepsilon
  \end{align*}
  е двойката $(\{a\}^\star \cdot \{b\}^\star, \{b\}^\star)$.
  
\end{problem}

\begin{problem}[Теорема за характеризация]
  Да разгледаме системата от непрекъснати оператори
  \begin{align*}
    & \val{\tau_1}(L_1,\dots,L_n) = L_1\\
    & \ \ \vdots\\
    & \val{\tau_n}(L_1,\dots,L_n) = L_n.
  \end{align*}
  Знаем, че тя притежава най-малко решение $(\hat{L}_1,\dots,\hat{L}_n)$.
  Докажете, че всеки от езиците $\hat{L}_i$ е регулярен.

  Докажете, че всеки регулярен език е елемент от най-малкото решение 
  на някоя система от непрекъснати изображения от горния вид.
\end{problem}

\section{Еквивалентност на денотационната и операционната семантика}

Нека тук да фиксираме една програма $R$
\begin{align*}
  & X_1 = \tau_1[X_1,\dots,X_n]\\
    & \vdots\\
  & X_n = \tau_n[X_1,\dots,X_n].
\end{align*}
Нека $(L_1,\dots,L_n)$ е най-малкото решение на непрекъснатото изображение $\Gamma \df \val{\tau_1}\times \cdots \times \val{\tau_n}$. Целта ни е да докажем, че за всяко $i = 1,\dots,n$ е изпълнено, че:
\[L_i = \{\alpha \in \Sigma^\star \mid \tau_i \Downarrow \alpha\}.\]
Този резултат ще наречем теорема за еквивалентност. Това ще направим на две стъпки.

\marginpar{Да напомним, че $L_i = \bigcup_k L^k_i$, където $L^0_i = \emptyset$ и $L^{k+1}_i = \val{\tau_i}(L^k_1,\dots,L^k_n)$. }

\begin{lemma}
  \marginpar{Тук раборим при фиксирана програма $R$.}
  За всеки индекс $r$ и всеки терм $\tau$ на езика \REG с променливи измежду $X_1,\dots,X_n$ е изпълнено, че:
  \[\val{\tau}(L^r_1,\dots,L^r_n) \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.\]
\end{lemma}
\begin{proof}
  Нека да кръстим $\textbf{Include}(r)$ твърдението
  ,,за всеки терм $\tau$ с променливи измежду $X_1,\dots,X_n$ е изпълнено, че:
  \[\val{\tau}(L^r_1,\dots,L^r_n) \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}".\]
  Целта ни е да докажем, че $(\forall r\in\Nat)\textbf{Include}(r)$. Това ще направим с индукция по $r$.
  
  Нека $r = 0$. Знаем, че $L^0_i = \emptyset$ за всеки индекс $i$ измежду $1,\dots,n$. Тук ще направим вътрешна индукция по построението на термовете $\tau$ за да докажем, че:
  \begin{equation}
    \label{eq:17}
    \val{\tau}(L^0_1,\dots,L^0_n) \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}
  \end{equation}
  \begin{itemize}
  % \item
    \marginpar{Тук е важно, че дефиницията на денотационната семантика следва индуктивното построение на термовете.}
    % Нека $\tau \equiv \emptyset$. Понеже $\val{\tau}(L^0_1,\dots,L^0_n) = \emptyset$, то е ясно, че Свойство~\ref{eq:17} е изпълнено.
  \item
    Нека $\tau \equiv \varepsilon$. Тогава $\val{\tau}(L^0_1,\dots,L^0_n) = \{\varepsilon\}$.
    От правилата на операционната семантика имаме, че $\varepsilon \Downarrow \varepsilon$.
    Заключаваме, че Свойство~\ref{eq:17} е изпълнено.
  \item
    Нека $\tau \equiv a \cdot X_j$, за някой индекс $j$ измежду $1,\dots,n$. Тогава
    \[\val{\tau}(L^0_1,\dots,L^0_n) = \{a\}\cdot L^0_j = \{a\} \cdot \emptyset = \emptyset\]
    и оттук е очевидно, че Свойство~\ref{eq:17} е в сила.
  \item
    Нека $\tau \equiv \rho + \mu$. Тогава $\val{\tau}(L^0_1,\dots,L^0_n) = \val{\rho}(L^0_1,\dots,L^0_n) \cup \val{\mu}(L^0_1,\dots,L^0_n)$. Сега от И.П. за Свойство~\ref{eq:17} получаваме, че
    \begin{align*}
      & \val{\rho}(L^0_1,\dots,L^0_n) \subseteq \{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\}\\
      & \val{\mu}(L^0_1,\dots,L^0_n) \subseteq \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\}.
    \end{align*}
    От правилата на операционната семантика имаме, че
    \begin{figure}[H]
      \begin{subfigure}[b]{0.5\textwidth}
        \begin{prooftree}
          \AxiomC{$\rho \Downarrow \alpha$}
          \LeftLabel{\scriptsize{(left-or)}}
          \UnaryInfC{$\rho + \mu \Downarrow \alpha$}
        \end{prooftree}
        \vspace*{2mm}
      \end{subfigure}
      ~
      \begin{subfigure}[b]{0.5\textwidth}
        \begin{prooftree}
          \AxiomC{$\mu \Downarrow \alpha$}
          \RightLabel{\scriptsize{(right-or)}}
          \UnaryInfC{$\rho + \mu \Downarrow \alpha$}
        \end{prooftree}
        \vspace*{2mm}
      \end{subfigure}
    \end{figure}
    Оттук веднага получаваме, че:
    \[\{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\} \cup \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\} = \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.\]
    Заключаваме, че:
    \begin{align*}
      \val{\tau}(L^0_1,\dots,L^0_n) & = \val{\rho}(L^0_1,\dots,L^0_n) \cup \val{\mu}(L^0_1,\dots,L^0_n)\\
                                    & \subseteq \{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\} \cup \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\}\\
                                    & = \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.
    \end{align*}
    Свойство~\ref{eq:17} е изпълнено за всеки терм $\tau$.
  \end{itemize}

  Нека $r > 0$ и като индукционно предположение да приемем, че е изпълнено $\textbf{Include}(r-1)$. Ще докажем, че е изпълнено $\textbf{Include}(r)$.
  \marginpar{Тук знаем, че \[L^r_i = \val{\tau_i}(L^{r-1}_1,\dots,L^{r-1}_n).\]}
  Ще направим вътрешна индукция по построението на термовете $\tau$ за да докажем, че:
  \begin{equation}
    \label{eq:18}
    \val{\tau}(L^r_1,\dots,L^r_n) \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.
  \end{equation}
  \begin{itemize}
  \item
    Нека $\tau \equiv \emptyset$. Отново, понеже $\val{\tau}(L^0_1,\dots,L^0_n) = \emptyset$, то е ясно, че Свойство~\ref{eq:18} е изпълнено.
  \item
    Нека $\tau \equiv \varepsilon$. Отново, понеже $\val{\tau}(L^0_1,\dots,L^0_n) = \{\varepsilon\}$,
    то от правилата на операционната семантика имаме, че $\varepsilon \Downarrow \varepsilon$.
    Заключаваме, че Свойство~\ref{eq:18} е изпълнено.
  \item
    Нека $\tau \equiv a \cdot X_j$ за някой индекс $j$ измежду $1,\dots,n$. Тогава
    \[\val{\tau}(L^r_1,\dots,L^r_n) = \{a\}\cdot L^r_j.\]
    Понеже сме приели, че $\textbf{Include}(r-1)$ е изпълено, то имаме автоматично, че:
    \[L^r_j = \val{\tau_j}(L^{r-1}_1,\dots,L^{r-1}_n) \subseteq \{\beta \in \Sigma^\star \mid \tau_j \Downarrow \beta\}.\]
    От правилата на операционната семантика имаме, че:
    \begin{prooftree}
      \AxiomC{$\tau_j \Downarrow \beta$}
      \UnaryInfC{$a \cdot X_j \Downarrow a \cdot \beta$}
    \end{prooftree}
    Понеже $\tau \equiv a \cdot X_j$, получаваме следното:
    \begin{equation}
      \label{eq:21}
      \{a\} \cdot \{\beta \in \Sigma^\star \mid \tau_j \Downarrow \beta\} = \{ \alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.
    \end{equation}
    Заключаваме, че:
    \begin{align*}
      \val{\tau}(L^r_1,\dots,L^r_n) & = \{a\} \cdot L^r_j \\
                                    & = \{a\} \cdot \val{\tau_j}(L^{r-1}_1,\dots,L^{r-1}_n)\\
                                    & \subseteq \{a\} \cdot \{\beta \in \Sigma^\star \mid \tau_j \Downarrow \beta\} & \comment\text{от }\textbf{Include}(r-1)\\
      & = \{ \alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}. & \comment\text{от \ref{eq:21}}
    \end{align*}
  \item
    Нека $\tau \equiv \rho + \mu$. Тук имаме, че
    \[\val{\tau}(L^r_1,\dots,L^r_n) = \val{\rho}(L^r_1,\dots,L^r_n) \cup \val{\mu}(L^r_1,\dots,L^r_n).\]
    Понеже $\tau$ е построен с помощта на $\rho$ и $\mu$, можем да използваме вътрешното индукционно предположение за $\rho$ и $\mu$, откъдето имаме, че:
    \begin{align*}
      & \val{\rho}(L^r_1,\dots,L^r_n) \subseteq \{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\}\\
      & \val{\mu}(L^r_1,\dots,L^r_n) \subseteq \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\}.
    \end{align*}
    От правилата на операционната семантика имаме, че
    \[\{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\} \cup \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\} = \{\alpha \in \Sigma^\star \mid \rho + \mu \Downarrow \alpha\}.\]
    Заключаваме, че:
    \begin{align*}
      \val{\tau}(L^r_1,\dots,L^r_n) & = \val{\rho}(L^r_1,\dots,L^r_n) \cup \val{\mu}(L^r_1,\dots,L^r_n)\\
                                    & \subseteq \{\alpha \in \Sigma^\star \mid \rho \Downarrow \alpha\} \cup \{\alpha \in \Sigma^\star \mid \mu \Downarrow \alpha\} \\
                                    & = \{\alpha \in \Sigma^\star \mid \mu+\rho \Downarrow \alpha\}\\
      & = \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.
    \end{align*}
    Свойство~\ref{eq:18} е изпълнено за всеки терм $\tau$.
  \end{itemize}
\end{proof}

\begin{corollary}
  Нека $L_1,\dots,L_n$ е най-малкото решение на непрекъснатото изображение $\Gamma \df \val{\tau_1}\times\cdots\times\val{\tau_n}$. Тогава за произволен терм $\tau$ с променливи измежду $X_1,\dots,X_n$ е изпълнено, че:
  \[\val{\tau}(L_1,\dots,L_n) \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.\]
\end{corollary}
\begin{proof}
  Използваме, че $\val{\tau}$ е непрекъснато изображение. Тогава
  \begin{align*}
    \val{\tau}(L_1,\dots,L_n) & = \val{\tau}(\bigcup_r L^r_1,\dots,\bigcup_rL^r_n)\\
                              & = \bigcup_r\val{\tau}(L^r_1,\dots,L^r_n)\\
                              & \subseteq \{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\}.
  \end{align*}
\end{proof}

\begin{lemma}
  Нека $L_1,\dots,L_n$ е неподвижна точка на $\Gamma \df \val{\tau_1}\times \cdots \times \val{\tau_n}$.
  За всеки терм $\tau$ с променливи измежду $X_1,\dots,X_n$ е  изпълнено, че:
  \[\{\alpha \in \Sigma^\star \mid \tau \Downarrow \alpha\} \subseteq \val{\tau}(L_1,\dots,L_n).\]
\end{lemma}
\begin{proof}
  Да означим с $\textbf{Include}(\ell)$ твърдението ,,за всеки терм $\tau$ с променливи измежду $X_1,\dots,X_n$ е изпълнено, че:
  \[\{\alpha \in \Sigma^\star \mid \tau \Downarrow^\ell \alpha\} \subseteq \val{\tau}(L_1,\dots,L_n)".\]
  Ще докажем, че $(\forall \ell\in\Nat)\textbf{Include}(\ell)$.

  Нека $\ell = 0$. Според правилата на операционната семантика, единственият случай, който имаме тук е $\tau \equiv \varepsilon$.

  Нека $\ell > 0$ и да разгледаме дума $\alpha$ и терм $\tau$, за които $\tau \Downarrow^\ell \alpha$. Тогава имаме три случая в зависимост от това какво е последното правило, което сме приложили.
  \begin{itemize}
  \item
    Първият случай е когато имаме, че $\tau \equiv a \cdot X_j$ и
    \begin{prooftree}
      \AxiomC{$\tau_j \Downarrow^{\ell-1} \beta$}
      \UnaryInfC{$a \cdot X_j \Downarrow^\ell a \cdot \beta$}
    \end{prooftree}
    Според правилата на операционната семантика имаме, че:
    \begin{equation}
      \label{eq:22}
      \{a\} \cdot \{\beta \in \Sigma^\star \mid \tau_j \Downarrow^{\ell-1} \beta\} = \{\alpha \in \Sigma^\star \mid \tau \Downarrow^{\ell} \alpha\}
    \end{equation}
    Знаем, че $\val{\tau}(L_1,\dots,L_n) = \{a\} \cdot L_j = \{a\} \cdot \val{\tau_j}(L_1,\dots,L_n)$,
    защото $L_1,\dots,L_n$ е \emph{неподвижна точка} на изображението $\Gamma$.
    От $\textbf{Include}(\ell-1)$ имаме следното:
    \begin{equation}
      \label{eq:11}
      \{\beta \in \Sigma^\star \mid \tau_j \Downarrow^{\ell-1} \beta\} \subseteq \val{\tau_j}(L_1,\dots,L_n).
    \end{equation}
    Заключаваме, че:
    \begin{align*}
      \{\alpha \in \Sigma^\star \mid \tau \Downarrow^\ell \alpha\} & = \{a\} \cdot \{\beta \in \Sigma^\star \mid \tau_j \Downarrow^{\ell-1} \beta\} & \comment\text{от (\ref{eq:22})}\\
                                                                   & \subseteq \{a\} \cdot \val{\tau_j}(L_1,\dots,L_n) & \comment\text{от (\ref{eq:11})}\\
                                                                   & = \{a\} \cdot L_j & \comment L_1,\dots,L_n\text{ е неподв. точка}\\
      & = \val{\tau}(L_1,\dots,L_n) & \comment\text{деф. на денот. сем.}
    \end{align*}
  \item
    Сега нека $\tau \equiv \rho + \mu$ и последното правило, което сме приложили е следното:
    \begin{prooftree}
      \AxiomC{$\rho \Downarrow^{\ell-1} \alpha$}
      \RightLabel{\scriptsize{(left-or)}}
      \UnaryInfC{$\rho + \mu \Downarrow^\ell \alpha$}
    \end{prooftree}

    Знаем, че $\val{\tau}(L_1,\dots,L_n) = \val{\rho}(L_1,\dots,L_n) \cup \val{\mu}(L_1,\dots,L_n)$.
    Понеже сме приели, че $\textbf{Include}(\ell-1)$ е изпълнено, получаваме:
    \begin{align*}
      \{\alpha \in \Sigma^\star \mid \rho \Downarrow^{\ell-1} \alpha\} & \subseteq \val{\rho}(L_1,\dots,L_n)\\
                                                                       & \subseteq \val{\tau}(L_1,\dots,L_n).
    \end{align*}
    
  \item
    Сега нека $\tau \equiv \rho + \mu$ и последното правило, което сме приложили е следното:
    \begin{prooftree}
      \AxiomC{$\mu \Downarrow^{\ell-1} \alpha$}
      \RightLabel{\scriptsize{(right-or)}}
      \UnaryInfC{$\rho + \mu \Downarrow^\ell \alpha$}
    \end{prooftree}
    Този случай е аналогичен на предния.
  \end{itemize}
\end{proof}

Така доказахме теоремата за еквивалентност на денотационната и операционната семантика.

\begin{framed}
  \begin{theorem}[Теорема за еквивалентност]
    Нека $L_1,\dots,L_n$ е най-малката неподвижна точка на $\Gamma$. Тогава за всеки индекс $i$ измежду $1,\dots,n$ е изпълнено, че:
    \[L_i = \{\alpha \in \Sigma^\star \mid \tau_i \Downarrow \alpha\}.\]  
  \end{theorem}
\end{framed}

\section{Разширения}

\input{reg/arden}

\input{reg/cfg}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../sep"
%%% End:
