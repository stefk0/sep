\section{Синтаксис}

\newcommand{\rename}[2]{\{\vv{#1}/{#2}\}}

\newcommand{\var}{\texttt{var}}
\newcommand{\fv}{\texttt{fv}}

\begin{itemize}
\item\index{тип}
  Типове
  \[\vv{a} ::= \vv{nat}\ |\ \vv{a} \to \vv{a}.\]
  Когато пишем 
  $\vv{a} \to \vv{b} \to \vv{c}$, то имаме предвид, че
  $\vv{a} \to (\vv{b} \to \vv{c})$.
\item\index{израз}
  \marginpar{Можем да си мислим за изразите като дървета.}
  Изрази
  \begin{align*}
    \tau ::=\ & \vv{n}\ |\ \vv{x}\ |\ \tau_1 + \tau_2\ |\ \tau_1 - \tau_2\ |\  \tau_1\ \vv{==}\ \tau_2\ |\ \ifelse{\tau_1}{\tau_2}{\tau_3}\ |\\
              & \tau_1\tau_2\ |\ \lamb{x}{a}{\tau_1}\ |\ \fix(\tau_1).
  \end{align*}
  Ще означаваме съвкупоността от всички изрази с $\mathcal{E}$, а съвкупността от всички променливи с $\mathcal{V}$.
  Да обърнем внимание, че не всички изрази са ,,смислени''. Например,
  $\lamb{x}{nat}{\vv{xx}}$ не е ясно какво означава.
  След малко ще дефинираме типизираща релация, с чиято помощ ще изхвърлим безслислените изрази.
  
  Понеже тук вече имаме свободни и свързани променливи, трябва да сме внимателни, когато правим замяна на един израз с друг. Да разгледаме функцията $\fv:\mathcal{E} \to \mathcal{P}(\mathcal{V})$, дефинирана със структурна индукция по построението на термовете по следния начин:
  
  \begin{itemize}
  \item
    $\fv(\vv{n}) = \emptyset$;
  \item
    $\fv(\vv{x}) = \{\vv{x}\}$;
  \item
    $\fv(\tau_1 + \tau_2) = \fv(\tau_1\ \vv{==}\ \tau_2) = \fv(\tau_1\tau_2) = \fv(\tau_1) \cup \fv(\tau_2)$;
  \item
    $\fv(\ifelse{\tau_1}{\tau_2}{\tau_3}) = \fv(\tau_1) \cup \fv(\tau_2) \cup \fv(\tau_3)$;
  \item
    $\fv(\lamb{x}{a}{\tau}) = \fv(\tau) \setminus \{x\}$.
  \item
    $\fv(\fix(\tau)) = \fv(\tau)$;
  \end{itemize}
  
  Ще казваме, че един израз $\tau$ е {\bf затворен}, ако $\fv(\tau) = \emptyset$.
  В противен случай, ще казваме, че изразът е {\bf отворен}.
\item
  \marginpar{Стойносттите понякога се наричат и канонични форми \cite{winskel}.}
  Ще казваме, че един израз е {\bf стойност}, ако той е затворен терм, съставен по следния начин:
  \[\vv{v} ::= \vv{n}\ |\ \lamb{x}{a}{\mu}.\]
  Интуицията тук е, че стойностите са затворени термове, в които не е възможно да се правят повече опростявания.
  Например, $\vv{5 + 6}$ не е стойност, защото може да се опрости до $\vv{11}$,
  но $\lamb{x}{nat}{\vv{5+6}}$ е стойност.
\end{itemize}

С $\tau\rename{x}{\rho}$ ще означаваме изразът получен от $\tau$, в който всяко \emph{свободно} срещане на променливата $\vv{x}$
е заменена с израза $\rho$. Можем да дадем формална дефиниция с индукция по построението на изразите:
\marginpar{Операцията $\rename{x}{\rho}$ заменя в дървото за израза $\tau$, всяко листо означено с $x$, което не участва в дърво с корен $\lambda x:a$, с дървото за израза $\rho$.}
\begin{itemize}
\item
  Ако $\tau \equiv \vv{n}$, то $\tau\rename{x}{\rho} \equiv \vv{n}$.
\item
  Ако $\tau \equiv \vv{x}$, то $\tau\rename{x}{\rho} \equiv \rho$.
\item
  Ако $\tau \equiv \vv{y}$, където $\vv{y} \not\equiv \vv{x}$, то $\tau\rename{x}{\rho} \equiv \vv{y}$.
\item
  Ако $\tau \equiv \tau_1 + \tau_2$, то $\tau\rename{x}{y} \equiv \tau_1\rename{x}{\rho} + \tau_2\rename{x}{\rho}$.
\item
  Ако $\tau \equiv \tau_1\ \vv{==}\ \tau_2$, то $\tau\rename{x}{\rho} \equiv \tau_1\rename{x}{\rho}\ \vv{==}\ \tau_2\rename{x}{\rho}$.
\item
  Ако $\tau \equiv \ifelse{\tau_1}{\tau_2}{\tau_3}$, то
  \[\tau\rename{x}{\rho} \equiv \ifelse{\tau_1\rename{x}{\rho}}{\tau_2\rename{x}{\rho}}{\tau_3\rename{x}{\rho}}.\]
\item
  Ако $\tau \equiv \lamb{x}{a}{\tau'}$, то $\tau\rename{x}{\rho} \equiv \tau$;
\item
  Ако $\tau \equiv \lamb{y}{a}{\tau'}$ и $\vv{y} \not\equiv \vv{x}$, то
  $\tau\rename{x}{\rho} \equiv \lamb{y}{a}{\tau'\rename{x}{\rho}}$.
\end{itemize}

Нека $\tau \equiv \lamb{x}{a}{\vv{x+y}}$. Обърнете внимание, че $\tau\rename{y}{\vv{x}} \equiv \lamb{x}{a}{\vv{x+x}}$,
т.е. тук получаваме израз, който ,,смислово'' е доста различен от първоначалния израз $\tau$.
Проблемът се състои в това, че при замяната на $\vv{x}$ с $\rho$, някоя свободна променлива на $\rho$ може да попадне под обхвата на някоя свързана
променлива на $\tau$.

\index{$\alpha$-еквивалентност}
\marginpar{Това е подходът на Хаскел Къри за дефиниране на замяна на променлива с израз \cite[стр. 578]{barendregt-handbook}.}
Сега ще дефинираме бинарна релация между изрази, която ще наричаме $\alpha$-ек\-ви\-ва\-лент\-ност.
Интуитивно, всеки два $\alpha$-еквивалентни израза трябва да бъдат смислово неотличими.
Това е най-малката релация между изрази, която ще означаваме с $\alphaEq$, за която са изпълнени свойствата:
\marginpar{
  В тази дефиниция единствено последният случай е интересен.
  Например,
  \[(\lamb{x}{a}{\vv{x+z}})\vv{x} \equiv_\alpha (\lamb{y}{a}{\vv{y+z}})\vv{x},\]
  но \[(\lamb{x}{a}{\vv{x+y}})\vv{x} \not\equiv_\alpha (\lamb{y}{a}{\vv{x+y}})\vv{x}.\]}
\begin{itemize}
\item
  $\vv{x} \alphaEq \vv{x}$;
\item
  $\vv{n} \alphaEq \vv{n}$;
\item
  ако $\tau_1 \alphaEq \rho_1$ и $\tau_2 \equiv_\alpha \rho_2$, то имаме, че
  \begin{align*}
    & \tau_1 + \tau_2 \alphaEq \rho_1 + \rho_2,\\
    & \tau_1\ \vv{==}\ \tau_2 \alphaEq \rho_1\ \vv{==}\ \rho_2,\\
    & \tau_1 \tau_2 \alphaEq \rho_1 \rho_2;
  \end{align*}
\item
  ако $\tau_1 \alphaEq \rho_1$, $\tau_2 \equiv_\alpha \rho_2$ и $\tau_3 \equiv_\alpha \rho_3$, то
  \[\ifelse{\tau_1}{\tau_2}{\tau_3} \alphaEq \ifelse{\rho_1}{\rho_2}{\rho_3};\]
\item
  ако $\tau \alphaEq \rho$, то $\fix(\tau) \equiv_\alpha \fix(\rho)$;
\item  
  ако $\tau\rename{x}{\vv{z}} \alphaEq \rho\rename{y}{\vv{z}}$, където $\vv{z} \not\in \var(\tau) \cup \var(\rho)$, то
  \[\lamb{x}{a}{\tau} \alphaEq \lamb{y}{a}{\rho}.\]
\end{itemize}

\marginpar{
Например,
\[\lamb{x}{a}{\vv{x+y}} \alphaEq \lamb{z}{a}{\vv{z+y}},\]
но
\[\lamb{x}{a}{\vv{x+y}} \not\alphaEq \lamb{y}{a}{\vv{y+y}},\]
защото
\[(\vv{x+y})\rename{x}{\vv{u}} \not\alphaEq (\vv{y+y})\rename{y}{\vv{u}}.\]}
Също така,
\[\lamb{x}{nat}{\vv{x + }\fix(\lamb{x}{nat}{\vv{x}})} \alphaEq \lamb{y}{nat}{\vv{y + }\fix(\lamb{z}{nat}{\vv{z}})}.\]

\index{терм}
\begin{framed}
\begin{definition}
  PCF терм е клас на еквивалентност от PCF изрази относно релацията $\alpha$-еквивалентност.
\end{definition}
\end{framed}

\marginpar{Това да се премести в нова глава за ламбда смятане.}
Де Бройн има по-програмистки подход за дефинирането на PCF термовете.
Всеки PCF терм има единствено представяне като израз, в който свързаните променливи са заменени с индекси.

{\bf Пример ......}


Сега искаме $\tau\subst{x}{\rho}$ да означава изразът получен от израза $\tau$, в който всяко \emph{свободно} срещане на променливата $\vv{x}$
е заменена с израза $\rho$. Тук имаме потенциален проблем. Искаме да направим тази замяна по такъв начин, че свободни променливи на $\rho$
да не попаднат под обхвата на свързани променливи от $\tau$. За да направим това, операцията $\subst{x}{\rho}$
трябва да работи не върху отделни изрази, а върху термове.
\index{субституция}
Можем да дадем формална дефиниция с индукция по построението на термовете:
\begin{itemize}
\item
  Ако $\tau \equiv \vv{n}$, то $\tau\subst{x}{\rho} \equiv \vv{n}$.
\item
  Ако $\tau \equiv \vv{x}$, то $\tau\subst{x}{\rho} \equiv \rho$.
\item
  Ако $\tau \equiv \vv{y}$ и $\vv{y} \not\equiv \vv{x}$, то $\tau\subst{x}{\rho} \equiv \vv{y}$.
\item
  Ако $\tau \equiv \tau_1 + \tau_2$, то
  \[\tau\subst{x}{y} \equiv \tau_1\subst{x}{\rho} + \tau_2\subst{x}{\rho}.\]
\item
  Ако $\tau \equiv \tau_1\ \vv{==}\ \tau_2$, то
  \[\tau\subst{x}{\rho} \equiv \tau_1\subst{x}{\rho}\ \vv{==}\ \tau_2\subst{x}{\rho}.\]
\item
  Ако $\tau \equiv \ifelse{\tau_1}{\tau_2}{\tau_3}$, то
  \[\tau\subst{x}{\rho} \equiv \ifelse{\tau_1\subst{x}{\rho}}{\tau_2\subst{x}{\rho}}{\tau_3\subst{x}{\rho}}.\]
\item
  Ако $\tau \equiv \lamb{y}{a}{\tau'}$, то
  \[\tau\subst{x}{\rho} \equiv \lamb{z}{a}{(\tau'\subst{y}{\vv{z}}\subst{x}{\rho})},\]
  където $\vv{z} \not\in \fv(\tau') \cup \fv(\rho) \cup \{\vv{x}\}$.
\end{itemize}

В тази дефиниция отново единствено последният случай е интересен.
Обърнете внимание, че според него заместването на $\vv{x}$ с $\rho$ дава като резултат безкрайно много
изрази, всички от които са $\alpha$-еквивалентни, т.е. ако работим на ниво термове операцията е добре дефинирана.

Това означава, че няма значение дали ще говорим за $\lamb{x}{a}{\vv{x+y}}$ или за $\lamb{y}{a}{\vv{y+z}}$.
Тези два израза описват един и същи терм и тези два израза са $\alpha$-еквивалентни.


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../sep"
%%% End:
