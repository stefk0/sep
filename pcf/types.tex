\section{Добре типизирани термове}\index{тип}

Типовите контексти представляват крайни редици от двойки от вида $\type{x}{a}$, т.е.
\[\Gamma ::= \emptyset\ |\ \Gamma,\type{x}{a}.\]
Например,
\[\Gamma = \vv{x}:\vv{nat},\ \vv{y}:\vv{nat} \to \vv{nat},\ \vv{z}:\vv{nat}.\]
\marginpar{Обикновено ще означаваме типовите контексти с главните гръцки $\Gamma, \Delta, \dots$.}
На един типов контекст $\Gamma$ може да се гледа и като на \emph{крайна} функция приемаща като аргумент променлива и връщаща тип.
Например, може понякога да пишем $\Gamma(\vv{x}) = \vv{nat}$, когато искаме да кажем, че променливата $\vv{x}$ има тип $\vv{nat}$ в типовия контекст $\Gamma$.
\marginpar{$\Gamma$ също се нарича и type environment.}
Ние искаме да работим само с коректно типизирани термове.
Например, не е ясно какво означава терма $\vv{1 + }\lamb{x}{nat}{\vv{x}}$,
защото трябва да съберем число и функция - два обекта от различен тип.
Ако в изразите имаме свободни променливи, то дали един израз е коректно типизиран ще зависи от типовия контекст.
Например, термът $\lamb{x}{nat}{\vv{z+x}}$ е добре типизиран в контекста $\Gamma = \vv{z}:\vv{nat}$, но не е добре типизиран в контекста
$\Delta = \vv{z}:\vv{nat}\to\vv{nat}$.
Сега ще дефинираме релация $\Gamma \vdash \tau : \vv{a}$, която ще ни казва, че термът $\tau$, относно типовият контекст $\Gamma$,
е добре типизиран и има тип $\vv{a}$.

\marginpar{Обърнете внимание, че можем да правим доказателства свойства на типизиращата релация с индукция по простроението на термовете.}

\begin{figure}[H]
  \centering
\begin{prooftree}
  \AxiomC{}
  \RightLabel{\scriptsize{(const)}}
  \UnaryInfC{$\Gamma \vdash \vv{n} : \vv{nat}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\vv{x} \in \texttt{dom}(\Gamma)$}
  \AxiomC{$\Gamma(\vv{x}) = \vv{a}$}
  \RightLabel{\scriptsize{(var)}}
  \BinaryInfC{$\Gamma \vdash \vv{x} : \vv{a}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash \tau_1:\vv{nat}$}
  \AxiomC{$\Gamma \vdash \tau_2:\vv{nat}$}
  \RightLabel{\scriptsize{(plus)}}
  \BinaryInfC{$\Gamma \vdash \tau_1 + \tau_2 : \vv{nat}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash \tau_1:\vv{nat}$}
  \AxiomC{$\Gamma \vdash \tau_2:\vv{nat}$}
  \RightLabel{\scriptsize{(eq)}}
  \BinaryInfC{$\Gamma \vdash \tau_1\ \vv{==}\ \tau_2 : \vv{nat}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash \tau_1:\vv{nat}$}
  \AxiomC{$\Gamma \vdash \tau_2:\vv{a}$}
  \AxiomC{$\Gamma \vdash \tau_3:\vv{a}$}
  \RightLabel{\scriptsize{(if)}}
  \TrinaryInfC{$\Gamma \vdash \ifelse{\tau_1}{\tau_2}{\tau_3} : \vv{a}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash \tau_1:\vv{a}\to\vv{b}$}
  \AxiomC{$\Gamma \vdash \tau_2:\vv{a}$}
  \RightLabel{\scriptsize{(app)}}
  \BinaryInfC{$\Gamma \vdash \tau_1\tau_2 : \vv{b}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash \tau:\vv{a}\to\vv{a}$}
  \RightLabel{\scriptsize{(fix)}}
  \UnaryInfC{$\Gamma \vdash \fix(\tau) : \vv{a}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$\vv{x} \not\in\vv{dom}(\Gamma)$}
  \AxiomC{$\Gamma, \type{x}{a} \vdash \tau:\vv{b}$}
  \RightLabel{\scriptsize{(lambda)}}
  \BinaryInfC{$\Gamma \vdash \lambda \type{x}{a}\ .\ \tau : \vv{a} \to \vv{b}$}
\end{prooftree}
  
  \caption{Релация за типизиране на термовете от езика \PCF}
  \label{fig:pcf:types:relation}
\end{figure}


Ако имаме затворен израз $\tau$, то ще пишем $\tau : \vv{a}$ вместо $\emptyset \vdash \tau : \vv{a}$.
Да положим
\[\text{PCF}_{\vv{a}} \df \{\tau \text{ е затворен терм}\mid \emptyset \vdash \tau : \vv{a}\}.\]

\begin{proposition}
  Ако $\Gamma \vdash \tau : \vv{a}$, то $\fv(\tau) \subseteq \vv{dom}(\Gamma)$.
\end{proposition}

\begin{proposition}
  Ако $\Gamma \vdash \tau : \vv{a}$ и $\Gamma \vdash \tau : \vv{b}$, то $\vv{a} = \vv{b}$.
\end{proposition}

\begin{corollary}
  Всеки затворен терм има най-много един тип.
\end{corollary}

\begin{problem}
  \marginpar{\cite[стр. 104]{types-programming-languages}}
  Докажете или опровергайте дали е възможно да съществува типов контекст $\Gamma$ и тип $\vv{a}$, такива че
  $\Gamma \vdash \type{xx}{a}$.
\end{problem}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../sep"
%%% End:
